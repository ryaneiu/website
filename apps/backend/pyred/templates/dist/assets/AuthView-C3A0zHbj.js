import{a as r,h as j,j as s,f as N,k as y,o as c,m as b,g as S,s as R,e as L,p as P,n as E}from"./index-Dxn2WRx0.js";import{T as U}from"./TransparentIconButton-BruHbNhV.js";import{L as w}from"./LoadableButton-DlaIFtR9.js";const d=r.forwardRef(function(n,t){const e=j("px-2 py-2 border border-black/15 rounded-md w-full",n.disabled?"cursor-not-allowed opacity-50":"");return s.jsx("input",{className:e,placeholder:n.placeholder,type:n.type,name:n.name,ref:t})});async function V(o,n,t){try{const e=await fetch(`${b}/api/signup/`,{method:"POST",body:JSON.stringify({username:o,password:n,email:t}),headers:{"Content-Type":"application/json"}});if(e.status!=201&&e.status!=200){try{const a=(await e.json()).detail;if(a)P({title:`Failed to sign up: ${a}`,type:"error",durationMs:5e3});else throw new Error("Parsing failed")}catch{c(`Failed to sign up: ${e.status} ${e.statusText}`)}return!1}return E("Sign up successfull, please login"),!0}catch(e){return console.error("Failed: ",e),c("Failed to sign up"),!1}}async function F(o,n){try{const t=await fetch(`${b}/token/`,{method:"POST",body:JSON.stringify({username:o,password:n}),headers:{"Content-Type":"application/json"}});if(t.status!=200){try{const l=(await t.json()).detail;if(l)c(`Failed to login: ${l}`);else throw new Error("Parsing failed")}catch{c(`Failed to login: ${t.status} ${t.statusText}`)}return!1}try{const e=await t.json(),l=e.refresh,a=e.access;if(l&&a)S(l),R(a);else throw new Error("Parsing failed. Server did not return refresh & access tokens as readable JSON")}catch(e){console.error("Failed to parse returned JSON. May not be fatal if using cookies. Error: ",e)}return L.setState({isLoggedIn:!0}),!0}catch(t){return console.error("Failed: ",t),c("Failed to login"),!1}}function I(o,n,t){if(o){const e=n.checkValidity()&&t.checkValidity();return{isValid:e,message:e?"":"Email not valid"}}else{const e=n.checkValidity()&&t.checkValidity(),l=t.value.length>=8;console.log("Valid: ",e),console.log("Password length: ",l);const a=l?"":"Password must be at least 8 characters long";let i="";return!l&&e?i=a:e?l&&e||(i="One or more inputs are not valid"):i="Email not valid",{isValid:e&&l,message:i}}}function O(){const o=N(),n=new URLSearchParams(window.location.search);let t=!1;n.has("action")&&(n.get("action")=="login"?t=!0:n.get("action")=="signup"&&(t=!1));const[e,l]=r.useState(t),[a,i]=r.useState(!1),h=r.useRef(null),g=r.useRef(null),m=r.useRef(null),f=r.useRef(null),p=r.useRef(null),x=j("text-underline text-black text-md",a?"opacity-50 cursor-not-allowed":"cursor-pointer"),v=s.jsxs(y,{className:"flex flex-col gap-3 items-center",children:[s.jsx("h1",{className:"text-3xl font-bold text-black",children:"Login"}),s.jsx(d,{placeholder:"Username",type:"text",name:"username",ref:h,disabled:a}),s.jsx(d,{placeholder:"Password",type:"password",name:"password",ref:g,disabled:a}),s.jsx(w,{text:"Login",onClick:async()=>{i(!0);const u=await F(h.current.value,g.current.value);i(!1),u&&o("/")},isLoading:a}),s.jsx("span",{className:x,onClick:()=>{l(!1)},children:"No account? Sign up!"})]},"login"),k=s.jsxs(y,{className:"flex flex-col gap-3 items-center ",children:[s.jsx("h1",{className:"text-3xl font-bold text-black",children:"Sign up"}),s.jsx("div",{className:"h-5"}),s.jsx(d,{placeholder:"Username",type:"text",name:"username",ref:m,disabled:a}),s.jsx(d,{placeholder:"Email",type:"email",name:"email",ref:f,disabled:a}),s.jsx(d,{placeholder:"Password",type:"password",name:"password",ref:p,disabled:a}),s.jsx(w,{text:"Signup",onClick:async()=>{const u=I(e,f.current,p.current);if(!u.isValid){c(`Invalid input: ${u.message}`);return}i(!0),await V(m.current.value,p.current.value,f.current.value),i(!1)},isLoading:a}),s.jsx("span",{className:x,onClick:()=>{l(!0)},children:"Already have an account?"})]},"signup");return s.jsxs("div",{className:"w-[100vw] h-[100vh] flex items-center justify-center relative",children:[s.jsx("span",{className:"absolute top-2 left-2",children:s.jsx(U,{icon:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#1f1f1f",children:s.jsx("path",{d:"m313-440 224 224-57 56-320-320 320-320 57 56-224 224h487v80H313Z"})}),onClick:()=>{o("/")}})}),s.jsx("div",{className:"px-4 py-4 w-72",children:e?v:k})]})}export{O as default};
